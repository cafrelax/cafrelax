<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Cafrelax</title>
  <style>
    /* Estilos generales */
    :root{
      --primary:#c49b63;
      --primary-dark:#a87f4a;
      --bg-overlay: rgba(0,0,0,0.6);
    }

    body {
      margin: 0;
      font-family: 'Arial', sans-serif;
      background: url('https://images.unsplash.com/photo-1509042239860-f550ce710b93') no-repeat center center/cover;
      color: #fff;
      text-align: center;
      min-height: 100vh;
    }

    header {
      background: var(--bg-overlay);
      padding: 60px 20px;
      position: relative;
      z-index: 1;
    }

    header h1 {
      font-size: 60px;
      margin: 0;
      font-weight: bold;
      letter-spacing: 3px;
    }

    header p {
      font-size: 20px;
      margin-top: 10px;
    }

    .menu-section {
      margin: 40px 20px;
      z-index: 1;
      position: relative;
    }

    h2 {
      font-size: 28px;
      margin-bottom: 20px;
      text-shadow: 0 2px 8px rgba(0,0,0,0.6);
    }

    .options {
      display: flex;
      justify-content: center;
      gap: 20px;
      flex-wrap: wrap;
    }

    .option {
      background: rgba(0, 0, 0, 0.6);
      padding: 18px;
      border-radius: 12px;
      cursor: pointer;
      transition: transform 0.25s, background 0.25s;
      width: 220px;
      box-shadow: 0 6px 18px rgba(0,0,0,0.5);
    }

    .option:hover {
      transform: translateY(-6px);
      background: rgba(255, 255, 255, 0.12);
    }

    button {
      background: var(--primary);
      border: none;
      padding: 10px 20px;
      margin-top: 15px;
      font-size: 16px;
      border-radius: 8px;
      cursor: pointer;
      color: white;
      transition: 0.3s;
    }

    button:hover {
      background: var(--primary-dark);
    }

    .hidden { display: none; }

    /* Bot√≥n flotante carrito */
    .cart-fab {
      position: fixed;
      right: 20px;
      bottom: 20px;
      width: 64px;
      height: 64px;
      border-radius: 50%;
      background: var(--primary);
      display: flex;
      align-items: center;
      justify-content: center;
      box-shadow: 0 12px 30px rgba(0,0,0,0.4);
      cursor: pointer;
      z-index: 1000;
      transition: transform 0.15s;
    }

    .cart-fab:hover { transform: translateY(-6px); }

    .cart-fab .icon {
      font-size: 24px;
      color: #fff;
    }

    .cart-badge {
      position: absolute;
      top: -8px;
      right: -8px;
      background: #ff4d4f;
      color: #fff;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    }

    /* Panel carrito deslizable */
    .cart-panel {
      position: fixed;
      right: -420px; /* fuera de pantalla */
      top: 0;
      height: 100%;
      width: 420px;
      max-width: 95%;
      background: rgba(10,10,10,0.95);
      color: #fff;
      box-shadow: -10px 0 40px rgba(0,0,0,0.6);
      transition: right 0.35s ease;
      z-index: 1100;
      padding: 20px;
      display: flex;
      flex-direction: column;
    }

    .cart-panel.open { right: 0; }

    .cart-header {
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
    }

    .cart-items {
      margin-top: 14px;
      overflow-y: auto;
      flex: 1;
      padding-right: 6px;
    }

    .cart-item {
      display:flex;
      justify-content:space-between;
      align-items:center;
      padding: 10px;
      border-radius: 8px;
      background: rgba(255,255,255,0.03);
      margin-bottom: 10px;
      gap:8px;
    }

    .item-left { text-align:left; }
    .item-name { font-weight: 600; }
    .item-meta { font-size: 13px; opacity: 0.8; }

    .remove-btn {
      background: transparent;
      border: none;
      color: #ff8080;
      cursor: pointer;
      font-weight: bold;
      font-size: 16px;
    }

    .cart-footer {
      margin-top: 12px;
      border-top: 1px solid rgba(255,255,255,0.06);
      padding-top: 12px;
    }

    .total-row {
      display:flex;
      justify-content:space-between;
      align-items:center;
      margin-bottom:10px;
      font-size:18px;
      font-weight:700;
    }

    .send-btn {
      width:100%;
      padding:12px;
      border-radius:10px;
      background: linear-gradient(90deg,var(--primary),var(--primary-dark));
      border:none;
      color:#fff;
      font-weight:700;
      cursor:pointer;
      box-shadow: 0 10px 30px rgba(0,0,0,0.3);
    }

    .empty-note {
      opacity:0.8;
      font-size:14px;
      margin-top:20px;
    }

    /* Responsive */
    @media(max-width:600px){
      header h1 { font-size:38px; }
      .option { width: 45%; padding: 12px; }
      .cart-panel { width: 100%; max-width: 420px; }
    }

  </style>
</head>
<body>

  <header>
    <h1>Cafrelax</h1>
    <p>Un espacio para relajarte y disfrutar lo mejor del caf√© ‚òï‚ú®</p>
  </header>

  <!-- Selecci√≥n inicial -->
  <div class="menu-section" id="inicio">
    <h2>¬øQu√© deseas hoy?</h2>
    <div class="options">
      <div class="option" onclick="mostrarMenu('comida')">üçî Comida</div>
      <div class="option" onclick="mostrarMenu('bebida')">‚òï Bebidas</div>
      <div class="option" onclick="mostrarMenu('combos')">ü•™ Combos</div>
    </div>
  </div>

  <!-- Men√∫ de Comida -->
  <div class="menu-section hidden" id="comida">
    <h2>Men√∫ de Comida</h2>
    <div class="options">
      <div class="option" onclick="agregarAlCarrito({ nombre:'S√°nduche', precio:2500, tipo:'Comida' })">ü•™ S√°nduche - $2.500</div>
      <div class="option" onclick="agregarAlCarrito({ nombre:'Brownie', precio:1000, tipo:'Comida' })">üç´ Brownie - $1.000</div>
      <div class="option" onclick="agregarAlCarrito({ nombre:'Panelita', precio:300, tipo:'Comida' })">üçØ Panelita - $300</div>
    </div>
    <button onclick="volver()">‚¨Ö Volver</button>
  </div>

  <!-- Men√∫ de Bebidas -->
  <div class="menu-section hidden" id="bebida">
    <h2>Escoge el tama√±o</h2>
    <div class="options">
      <div class="option" onclick="seleccionarTama√±o('Mediano (7 oz)')">ü•§ Mediano (7 oz)</div>
      <div class="option" onclick="seleccionarTama√±o('Grande (8 oz)')">ü•§ Grande (8 oz)</div>
    </div>
    <button onclick="volver()">‚¨Ö Volver</button>
  </div>

  <!-- Tipos de bebidas -->
  <div class="menu-section hidden" id="tiposBebidas">
    <h2>Escoge tu bebida</h2>
    <div class="options">
      <div class="option" onclick="agregarBebidaAlCarrito('Tinto',2000)">‚òï Tinto - $2.000</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Caf√©',2500)">‚òï Caf√© - $2.500</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Capuccino',3000)">‚òï Capuccino - $3.000</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Caf√© fr√≠o',2500)">ü•∂ Caf√© fr√≠o - $2.500</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Caf√© bomb√≥n',3000)">üç´ Caf√© bomb√≥n - $3.000</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Caf√© bomb√≥n con leche',3500)">ü•õ Caf√© bomb√≥n con leche - $3.500</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Arom√°tica de hierbabuena',2000)">üåø Arom√°tica de hierbabuena - $2.000</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Arom√°tica de manzanilla',2000)">üåº Arom√°tica de manzanilla - $2.000</div>
      <div class="option" onclick="agregarBebidaAlCarrito('Insta crem',2500)">‚òï Insta crem - $2.500</div>
    </div>
    <button onclick="volver()">‚¨Ö Volver</button>
  </div>

  <!-- Men√∫ de Combos -->
  <div class="menu-section hidden" id="combos">
    <h2>Combos</h2>
    <div class="options">
      <div class="option" onclick="agregarAlCarrito({ nombre:'Combo 1: Caf√© + Brownie', precio:3500, tipo:'Combo' })">‚òï + üç´ Caf√© + Brownie - $3.500</div>
      <div class="option" onclick="agregarAlCarrito({ nombre:'Combo 2: Caf√© + S√°nduche', precio:5000, tipo:'Combo' })">‚òï + ü•™ Caf√© + S√°nduche - $5.000</div>
      <div class="option" onclick="agregarAlCarrito({ nombre:'Combo 3: Capuccino + Brownie', precio:4000, tipo:'Combo' })">‚òï + üç´ Capuccino + Brownie - $4.000</div>
    </div>
    <button onclick="volver()">‚¨Ö Volver</button>
  </div>

  <!-- Bot√≥n flotante del carrito -->
  <div class="cart-fab" id="cartFab" title="Ver carrito (abrir)" onclick="toggleCart()">
    <div class="icon">üõí</div>
    <div class="cart-badge" id="cartCount">0</div>
  </div>

  <!-- Panel deslizable del carrito -->
  <div class="cart-panel" id="cartPanel" aria-hidden="true">
    <div class="cart-header">
      <div>
        <h3 style="margin:0">Tu carrito</h3>
        <div style="font-size:13px; opacity:0.8;">Guarda autom√°ticamente (sesi√≥n)</div>
      </div>
      <div>
        <button onclick="cerrarCart()" style="background:transparent;border:none;color:#fff;font-size:22px;cursor:pointer">‚úï</button>
      </div>
    </div>

    <div class="cart-items" id="cartItems">
      <!-- Items din√°micos -->
    </div>

    <div class="cart-footer">
      <div class="total-row">
        <div>Total</div>
        <div id="cartTotal">$0</div>
      </div>
      <button class="send-btn" id="sendBtn" onclick="enviarPorWhatsApp()" title="Enviar pedido por WhatsApp">üì≤ Enviar pedido por WhatsApp</button>
      <div class="empty-note" id="emptyNote" style="display:none">Tu carrito est√° vac√≠o. Agrega productos desde el men√∫.</div>
    </div>
  </div>

  <script>
    // Datos y estado
    const PHONE = "573016160481"; // WhatsApp Colombia
    let tama√±oSeleccionado = "";
    let carrito = [];

    // Cargar carrito desde localStorage si existe
    function cargarCarrito() {
      try {
        const raw = localStorage.getItem('cafrelax_carrito_v1');
        if (raw) {
          carrito = JSON.parse(raw);
        } else {
          carrito = [];
        }
      } catch(e) {
        carrito = [];
      }
      actualizarUIcarrito();
    }

    function guardarCarrito() {
      try {
        localStorage.setItem('cafrelax_carrito_v1', JSON.stringify(carrito));
      } catch(e) {
        // ignorar si no se puede guardar
      }
    }

    // Mostrar / ocultar secciones
    function mostrarMenu(menu) {
      document.querySelectorAll(".menu-section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById(menu).classList.remove("hidden");
    }

    function volver() {
      document.querySelectorAll(".menu-section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById("inicio").classList.remove("hidden");
    }

    function seleccionarTama√±o(tama√±o) {
      tama√±oSeleccionado = tama√±o;
      // Avanzar a tipos de bebidas
      document.querySelectorAll(".menu-section").forEach(sec => sec.classList.add("hidden"));
      document.getElementById("tiposBebidas").classList.remove("hidden");
    }

    // Agrega un producto gen√©rico al carrito (comida, combos, etc)
    function agregarAlCarrito(producto) {
      const item = {
        id: generarId(),
        nombre: producto.nombre,
        precio: producto.precio,
        tipo: producto.tipo || 'Item',
        meta: '' // info extra (size, notas)
      };
      carrito.push(item);
      guardarCarrito();
      actualizarUIcarrito();
      abrirPanelTemporal();
    }

    // Agregar bebida considerando tama√±oSeleccionado
    function agregarBebidaAlCarrito(nombre, precioBase) {
      if (!tama√±oSeleccionado) {
        alert("Por favor, selecciona primero el tama√±o de la bebida.");
        mostrarMenu('bebida');
        return;
      }
      // Si quieres diferenciar precios por tama√±o en futuro, aqu√≠ puedes ajustar precioBase
      const item = {
        id: generarId(),
        nombre: nombre,
        precio: precioBase,
        tipo: 'Bebida',
        meta: `Tama√±o: ${tama√±oSeleccionado}`
      };
      carrito.push(item);
      guardarCarrito();
      actualizarUIcarrito();
      abrirPanelTemporal();
      // opcional: reset tama√±oSeleccionado si quieres que se elija cada vez
      tama√±oSeleccionado = "";
    }

    function generarId() {
      return 'id_' + Math.random().toString(36).slice(2,9);
    }

    // UI carrito
    function actualizarUIcarrito() {
      const itemsCont = document.getElementById('cartItems');
      const countEl = document.getElementById('cartCount');
      const totalEl = document.getElementById('cartTotal');
      const emptyNote = document.getElementById('emptyNote');

      itemsCont.innerHTML = '';
      if (carrito.length === 0) {
        countEl.textContent = '0';
        totalEl.textContent = formatCOP(0);
        emptyNote.style.display = 'block';
      } else {
        emptyNote.style.display = 'none';
        carrito.forEach(item => {
          const div = document.createElement('div');
          div.className = 'cart-item';
          div.innerHTML = `
            <div class="item-left">
              <div class="item-name">${escapeHtml(item.nombre)}</div>
              <div class="item-meta">${escapeHtml(item.meta || item.tipo)}</div>
            </div>
            <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px">
              <div style="font-weight:700">${formatCOP(item.precio)}</div>
              <button class="remove-btn" onclick="eliminarDelCarrito('${item.id}')">‚úï</button>
            </div>
          `;
          itemsCont.appendChild(div);
        });
        countEl.textContent = String(carrito.length);
        const total = carrito.reduce((s,i)=> s + Number(i.precio || 0), 0);
        totalEl.textContent = formatCOP(total);
      }
    }

    function eliminarDelCarrito(id) {
      carrito = carrito.filter(i => i.id !== id);
      guardarCarrito();
      actualizarUIcarrito();
    }

    // Formato moneda COP
    function formatCOP(value) {
      // mostramos sin decimales, con separador de miles y signo $
      return '$' + Number(value).toLocaleString('es-CO', { maximumFractionDigits: 0 });
    }

    // Enviar por WhatsApp
    function enviarPorWhatsApp() {
      if (carrito.length === 0) {
        alert("Tu carrito est√° vac√≠o.");
        return;
      }
      const total = carrito.reduce((s,i)=> s + Number(i.precio || 0), 0);
      let mensaje = `Hola, quiero pedir:\n`;
      carrito.forEach((i, idx) => {
        mensaje += `${idx+1}. ${i.nombre}`;
        if (i.meta) mensaje += ` (${i.meta})`;
        mensaje += ` - ${formatCOP(i.precio)}\n`;
      });
      mensaje += `\nTotal: ${formatCOP(total)}\n\nGracias üòä`;
      const url = `https://wa.me/${PHONE}?text=${encodeURIComponent(mensaje)}`;
      // Abrir WhatsApp en nueva pesta√±a
      window.open(url, '_blank');
    }

    // Abrir / cerrar panel
    function toggleCart() {
      const panel = document.getElementById('cartPanel');
      panel.classList.toggle('open');
      panel.setAttribute('aria-hidden', !panel.classList.contains('open'));
    }
    function cerrarCart() {
      const panel = document.getElementById('cartPanel');
      panel.classList.remove('open');
      panel.setAttribute('aria-hidden', 'true');
    }

    // Abrir el panel temporalmente para que el usuario vea lo que agreg√≥
    let openTimeout;
    function abrirPanelTemporal() {
      const panel = document.getElementById('cartPanel');
      panel.classList.add('open');
      panel.setAttribute('aria-hidden', 'false');
      clearTimeout(openTimeout);
      openTimeout = setTimeout(()=> {
        // no cerramos autom√°ticamente para que el usuario pueda interactuar; dejamos abierto
      }, 1000);
    }

    // Protecci√≥n b√°sica contra inyecci√≥n de HTML en nombres
    function escapeHtml(text) {
      if (!text && text !== 0) return '';
      return String(text)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#039;');
    }

    // Inicializar
    cargarCarrito();

    // Limpieza si usuario desea (opcional - no expuesta en UI por ahora)
    // function vaciarCarrito() { carrito=[]; guardarCarrito(); actualizarUIcarrito(); }

    // Evita que al recargar se pierda tama√±o seleccionado en memoria (opcional)
    window.addEventListener('beforeunload', () => {
      // guardamos tama√±o seleccionado por si se desea recuperar en loader futuro
      localStorage.setItem('cafrelax_tamano_v1', tama√±oSeleccionado || '');
    });

    // Si quieres recuperar tama√±o seleccionado (no mostrado en UI actualmente)
    (function recuperarTamano(){
      const t = localStorage.getItem('cafrelax_tamano_v1');
      if (t) tama√±oSeleccionado = t;
    })();

  </script>
</body>
</html>
